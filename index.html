<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Student Portal</title>

  <!-- Mobile / PWA meta -->
  <meta name="viewport"
        content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, viewport-fit=cover">
  <meta name="theme-color" content="#1159c4">
  <link rel="manifest" href="manifest.json">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="default">
  <meta name="apple-mobile-web-app-title" content="Student Portal">
  <link rel="apple-touch-icon" href="icons/icon-192.png">
  <link rel="icon" type="image/png" sizes="192x192" href="icons/icon-192.png">
  <link rel="icon" type="image/png" sizes="512x512" href="icons/icon-512.png">

  <style>
    :root {
      --brand: #1159c4;
      --bg: #f4f6ff;
      --card: #ffffff;
      --muted: #6b7280;
      --radius: 16px;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Arial, sans-serif;
      background: var(--bg);
      color: #0f172a;
      -webkit-font-smoothing: antialiased;
      touch-action: manipulation;
      overscroll-behavior: none;
    }

    a {
      text-decoration: none;
      color: inherit;
    }

    /* HEADER */
    .topbar {
      position: sticky;
      top: 0;
      z-index: 20;
      background: var(--brand);
      color: #fff;
      padding: 16px 16px 20px;
      display: flex;
      align-items: center;
      gap: 12px;
      border-bottom-left-radius: 18px;
      border-bottom-right-radius: 18px;
      box-shadow: 0 10px 24px rgba(15, 23, 42, 0.35);
    }

    .logo {
      width: 40px;
      height: 40px;
      border-radius: 10px;
      background: #ffffff;
      display: flex;
      align-items: center;
      justify-content: center;
      overflow: hidden;
    }

    .logo img {
      width: 80%;
      height: 80%;
      object-fit: contain;
    }

    .header-text {
      flex: 1;
      min-width: 0;
    }

    .header-title {
      font-size: 16px;
      font-weight: 700;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .header-sub {
      font-size: 12px;
      opacity: 0.9;
    }

    .header-actions button {
      background: transparent;
      border: 0;
      color: #fff;
      padding: 6px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    /* LAYOUT */
    main {
      padding: 12px;
      padding-bottom: 90px;
      max-width: 900px;
      margin: 0 auto;
    }

    .page {
      display: none;
      animation: fadeUp .25s ease-out;
    }

    .page.active {
      display: block;
    }

    @keyframes fadeUp {
      from {
        opacity: 0;
        transform: translateY(6px);
      }
      to {
        opacity: 1;
        transform: none;
      }
    }

    /* CARDS */
    .card {
      background: var(--card);
      border-radius: var(--radius);
      padding: 14px 14px;
      box-shadow: 0 10px 28px rgba(15, 23, 42, 0.08);
      margin-bottom: 12px;
    }

    .pill {
      border-radius: 999px;
      border: 1px solid #e5e7eb;
      padding: 6px 14px;
      font-size: 12px;
      background: #fff;
    }

    .muted {
      color: var(--muted);
    }

    .small {
      font-size: 13px;
    }

    /* HOME */
    .home-top {
      display: flex;
      justify-content: space-between;
      gap: 10px;
      align-items: center;
    }

    .home-top-main {
      flex: 1;
    }

    .home-top-title {
      font-weight: 800;
    }

    .home-top-sub {
      font-size: 13px;
      color: var(--muted);
      margin-top: 4px;
    }

    .snap-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 10px;
    }

    .quick-grid {
      display: flex;
      gap: 10px;
      margin-top: 10px;
    }

    .quick-item {
      flex: 1;
      min-width: 80px;
      border-radius: 14px;
      background: #f9fbff;
      box-shadow: 0 8px 18px rgba(15, 23, 42, 0.04);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 8px 4px;
      cursor: pointer;
      transition: transform .12s ease, box-shadow .12s ease;
    }

    .quick-item:hover {
      transform: translateY(-2px);
      box-shadow: 0 10px 24px rgba(15, 23, 42, 0.08);
    }

    .quick-label {
      font-size: 12px;
      margin-top: 4px;
    }

    /* HOME BANNER */
    .home-banner {
      border-radius: 18px;
      overflow: hidden;
      padding: 0;
    }

    .home-banner img {
      width: 100%;
      display: block;
      height: 180px;
      object-fit: cover;
    }

    /* UniSA-style NEXT CLASS / NEXT ASSESSMENT */
    .next-row {
      display: flex;
      flex-direction: column;
      gap: 8px;
      margin-top: 6px;
    }

    .next-card {
      display: flex;
      border-radius: 16px;
      overflow: hidden;
      border: 1px solid #e5e7eb;
      background: #ffffff;
      box-shadow: 0 2px 4px rgba(15, 23, 42, 0.06);
    }

    .next-date {
      width: 60px;
      background: var(--brand);
      color: #ffffff;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 10px 4px;
    }

    .next-date-day {
      font-size: 18px;
      font-weight: 700;
      line-height: 1;
    }

    .next-date-month {
      font-size: 11px;
      text-transform: uppercase;
      margin-top: 2px;
    }

    .next-date-label {
      font-size: 10px;
      opacity: 0.9;
      margin-top: 6px;
      text-align: center;
    }

    .next-body {
      flex: 1;
      padding: 8px 10px;
      background: #e0ebff;
    }

    .next-heading {
      font-size: 11px;
      font-weight: 600;
      color: var(--brand);
      text-transform: uppercase;
      margin-bottom: 2px;
    }

    .next-time {
      font-size: 12px;
      font-weight: 500;
      margin-bottom: 3px;
    }

    .next-location {
      font-size: 11px;
      color: var(--muted);
      margin-bottom: 3px;
    }

    .next-course {
      font-size: 11px;
      color: #1f2933;
    }

    /* SUBJECT LIST LIKE UniSA */
    .subject-list {
      display: flex;
      flex-direction: column;
      gap: 6px;
      margin-top: 6px;
    }

    .subject-item {
      display: flex;
      border-radius: 12px;
      overflow: hidden;
      border: 1px solid #e5e7eb;
      background: #ffffff;
    }

    .subject-code {
      width: 72px;
      background: var(--brand);
      color: #ffffff;
      padding: 8px 6px;
      display: flex;
      flex-direction: column;
      justify-content: center;
      gap: 2px;
    }

    .subject-code-main {
      font-size: 11px;
      font-weight: 600;
    }

    .subject-code-year {
      font-size: 10px;
      opacity: 0.9;
    }

    .subject-body {
      flex: 1;
      padding: 8px 10px;
      display: flex;
      flex-direction: column;
      gap: 3px;
    }

    .subject-title {
      font-size: 12px;
      font-weight: 500;
    }

    .subject-meta {
      font-size: 11px;
      color: var(--muted);
    }

    /* TIMETABLE PAGE */
    .timetable-card {
      position: relative;
      border-radius: 18px;
      padding: 16px 16px 18px;
      overflow: hidden;
      color: #ffffff;
      background-image:
        linear-gradient(135deg, rgba(15, 23, 42, 0.75), rgba(17, 89, 196, 0.8)),
        url("electronics-bg.jpg");
      background-size: cover;
      background-position: center;
      box-shadow: 0 14px 32px rgba(15, 23, 42, 0.45);
    }

    .timetable-card-inner {
      position: relative;
      z-index: 1;
    }

    /* ASSIGNMENTS */
    .assign-controls {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-top: 8px;
      margin-bottom: 8px;
    }

    .input,
    .select {
      padding: 8px;
      border-radius: 10px;
      border: 1px solid #e5e7eb;
      background: #fff;
      font-size: 13px;
    }

    .assign-list {
      display: flex;
      flex-direction: column;
      gap: 8px;
      margin-top: 6px;
    }

    .assign-row {
      display: flex;
      justify-content: space-between;
      gap: 8px;
      align-items: center;
    }

    .assign-left {
      flex: 1;
    }

    .badge {
      display: inline-block;
      padding: 4px 8px;
      border-radius: 999px;
      font-size: 11px;
      background: #e0ebff;
      color: var(--brand);
      font-weight: 600;
    }

    /* PROFILE */
    .profile-card {
      text-align: center;
    }

    .avatar {
      width: 90px;
      height: 90px;
      border-radius: 24px;
      background: #ffffff;
      margin: 0 auto 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      overflow: hidden;
      box-shadow: 0 10px 26px rgba(15, 23, 42, 0.15);
    }

    .avatar span {
      font-weight: 800;
      font-size: 26px;
      color: var(--brand);
    }

    .profile-name {
      font-weight: 800;
      font-size: 18px;
      margin-top: 4px;
    }

    .profile-degree {
      font-size: 13px;
      color: var(--muted);
    }

    .profile-info {
      text-align: left;
      margin-top: 14px;
      display: flex;
      flex-direction: column;
      gap: 6px;
    }

    .profile-row {
      background: #f9fbff;
      border-radius: 12px;
      padding: 8px 10px;
      font-size: 13px;
    }

    .profile-label {
      font-weight: 600;
      font-size: 12px;
      color: var(--muted);
    }

    /* ID CARD PREVIEW */
    .id-preview-wrapper {
      margin-top: 12px;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 4px;
      cursor: pointer;
    }

    .id-preview-image {
      width: 100%;
      max-width: 260px;
      border-radius: 16px;
      box-shadow: 0 10px 26px rgba(15, 23, 42, 0.4);
      object-fit: contain;
      transition: transform .15s ease, box-shadow .15s ease;
    }

    .id-preview-wrapper:active .id-preview-image {
      transform: scale(0.97);
      box-shadow: 0 6px 18px rgba(15, 23, 42, 0.35);
    }

    /* ID FULLSCREEN */
    .id-fullscreen-wrapper {
      width: 100%;
      height: 100%;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .id-fullscreen-image {
      height: 60vh;
      max-width: 80vw;
      width: auto;
      display: block;
      margin: 0 auto;
      border-radius: 20px;
      object-fit: contain;
      transform: rotate(90deg);
      box-shadow: 0 18px 40px rgba(15, 23, 42, 0.4);
    }

    /* MAP FULLSCREEN */
    .map-fullscreen-wrapper {
      width: 100%;
      height: 100%;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .map-fullscreen-image {
      width: 100vw;
      height: 100vh;
      object-fit: contain;
      display: block;
    }

    /* MODAL */
    .modal-backdrop {
      position: fixed;
      inset: 0;
      background: rgba(255, 255, 255, 0.0);
      backdrop-filter: blur(18px) saturate(120%);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 40;
    }

    .modal {
      background: rgba(255, 255, 255, 0.98);
      width: min(420px, 94vw);
      border-radius: 16px;
      padding: 14px 14px 16px;
      box-shadow: 0 20px 40px rgba(15, 23, 42, 0.45);
      max-height: 90vh;
      overflow: auto;
      transform: translateY(0);
      opacity: 1;
      transition: transform .22s ease-out, opacity .22s ease-out;
    }

    .modal-head {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 8px;
    }

    .modal-head h3 {
      font-size: 16px;
    }

    .modal-body {
      font-size: 13px;
      color: #111827;
    }

    .btn-link {
      border: 0;
      background: #eef2ff;
      padding: 7px 10px;
      border-radius: 10px;
      font-size: 13px;
      cursor: pointer;
    }

    /* FULLSCREEN MODAL */
    .modal-fullscreen {
      width: 100vw;
      height: 100vh;
      max-width: none;
      border-radius: 0;
      display: flex;
      flex-direction: column;
      padding: 14px 14px 20px;
    }

    .modal-fullscreen .modal-body {
      flex: 1;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    /* BOTTOM NAV */
    .bottom-nav {
      position: fixed;
      left: 8px;
      right: 8px;
      bottom: 10px;
      background: #ffffff;
      border-radius: 18px;
      padding: 6px 4px;
      display: flex;
      justify-content: space-around;
      box-shadow: 0 10px 30px rgba(15, 23, 42, 0.18);
      z-index: 30;
    }

    .nav-item {
      flex: 1;
      text-align: center;
      font-size: 11px;
      color: var(--muted);
      cursor: pointer;
      padding: 4px 0;
    }

    .nav-item span {
      display: block;
      margin-top: 2px;
    }

    .nav-item.active {
      color: var(--brand);
      font-weight: 600;
    }

    @media (min-width: 900px) {
      main {
        padding-top: 16px;
      }
    }
  </style>
</head>
<body>

<header class="topbar" role="banner">
  <div class="logo">
    <img src="icons/icon-192.png" alt="Portal logo">
  </div>
  <div class="header-text">
    <div class="header-title" id="appTitle">Student Portal — Home</div>
    <div class="header-sub">Welcome, <span id="welcomeName">Student</span></div>
  </div>
  <div class="header-actions">
    <!-- SETTINGS ICON -->
    <button aria-label="Settings" onclick="openSettings()">
      <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
        <path d="M12 8.5a3.5 3.5 0 1 0 0 7 3.5 3.5 0 0 0 0-7Z"
              stroke="currentColor" stroke-width="1.8" />
        <path d="M4.5 13.5v-3l1.7-.6a1 1 0 0 0 .6-.6l.5-1.6 2.8-1 1.2 1a1 1 0 0 0 .7.3h1.8a1 1 0 0 0 .7-.3l1.2-1 2.8 1 .5 1.6a1 1 0 0 0 .6.6l1.7.6v3l-1.7.6a1 1 0 0 0-.6.6l-.5 1.6-2.8 1-1.2-1a1 1 0 0 0-.7-.3h-1.8a1 1 0 0 0-.7.3l-1.2 1-2.8-1-.5-1.6a1 1 0 0 0-.6-.6l-1.7-.6Z"
              stroke="currentColor" stroke-width="1.8"
              stroke-linecap="round" stroke-linejoin="round" />
      </svg>
    </button>
  </div>
</header>

<main>
  <!-- HOME -->
  <section id="homePage" class="page active">
    <!-- UniSA-style next class / assessment -->
    <div class="card">
      <div class="snap-header">
        <div>
          <div class="small muted">Today</div>
          <div class="home-top-title">Schedule overview</div>
        </div>
      </div>
      <div class="next-row">
        <div class="next-card">
          <div class="next-date">
            <div class="next-date-day">30</div>
            <div class="next-date-month">OCT</div>
            <div class="next-date-label">Next class</div>
          </div>
          <div class="next-body">
            <div class="next-heading">Next class</div>
            <div class="next-time">09:00 AM – 12:00 PM ACDT</div>
            <div class="next-location">GK1-51 MAG (W5H)</div>
            <div class="next-course">
              Becoming a Primary Teacher with an Arts Specialisation
            </div>
          </div>
        </div>

        <div class="next-card">
          <div class="next-date">
            <div class="next-date-day">30</div>
            <div class="next-date-month">OCT</div>
            <div class="next-date-label">Next assessment</div>
          </div>
          <div class="next-body">
            <div class="next-heading">Next assessment</div>
            <div class="next-time">03:00 PM ACDT</div>
            <div class="next-location">Assessment 3 · Project</div>
            <div class="next-course">
              Design and Technology Education
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- QUICK ACTIONS -->
    <div class="card">
      <div class="home-top">
        <div>
          <div class="small muted">Quick actions</div>
          <div class="home-top-title">Open tools & links</div>
        </div>
      </div>
      <div class="quick-grid">
        <!-- NOTES -->
        <div class="quick-item" onclick="openNotes()">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
            <rect x="4" y="3" width="16" height="18" rx="2"
                  stroke="#1159c4" stroke-width="1.6" />
            <path d="M8 8h8M8 12h5"
                  stroke="#1159c4" stroke-width="1.6" stroke-linecap="round" />
          </svg>
          <div class="quick-label">Notes</div>
        </div>
        <!-- CAMPUS MAP -->
        <div class="quick-item" onclick="openCampusMap()">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
            <path d="M6 4l6-2 6 2v16l-6 2-6-2V4z"
                  stroke="#1159c4" stroke-width="1.6" stroke-linejoin="round" />
            <path d="M12 2v18"
                  stroke="#1159c4" stroke-width="1.6" stroke-linejoin="round" />
          </svg>
          <div class="quick-label">Campus map</div>
        </div>
        <!-- ASSIGNMENTS -->
        <div class="quick-item" onclick="switchTo('assignments')">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
            <rect x="3" y="4" width="18" height="16" rx="2"
                  stroke="#1159c4" stroke-width="1.6" />
            <path d="M9 8h6"
                  stroke="#1159c4" stroke-width="1.6" stroke-linecap="round" />
          </svg>
          <div class="quick-label">Assignments</div>
        </div>
      </div>
    </div>

    <!-- SIMPLE TIMETABLE SUMMARY -->
    <div class="card">
      <div class="snap-header">
        <div>
          <div class="small muted">Timetable</div>
          <div class="home-top-title">No classes this week</div>
        </div>
      </div>
      <div class="small muted">When you add subjects, they'll appear here.</div>
    </div>

    <!-- HOME BANNER (students image) -->
    <div class="card home-banner">
      <img src="students-banner.jpg" alt="Students on campus">
    </div>

    <!-- SUBJECTS LIST (UniSA-style blue/white) -->
    <div class="card">
      <div class="snap-header">
        <div>
          <div class="small muted">Enrolment</div>
          <div class="home-top-title">Your subjects</div>
        </div>
      </div>
      <div class="subject-list">
        <div class="subject-item">
          <div class="subject-code">
            <div class="subject-code-main">EDUC 1081</div>
            <div class="subject-code-year">SP2, 2020</div>
          </div>
          <div class="subject-body">
            <div class="subject-title">
              Professional Experience 1: Introduction to Education
            </div>
            <div class="subject-meta">City East · On campus</div>
          </div>
        </div>

        <div class="subject-item">
          <div class="subject-code">
            <div class="subject-code-main">EDUC 1099</div>
            <div class="subject-code-year">SP5, 2020</div>
          </div>
          <div class="subject-body">
            <div class="subject-title">
              Becoming a Primary Teacher with an Arts Specialisation
            </div>
            <div class="subject-meta">Magill · On campus</div>
          </div>
        </div>

        <div class="subject-item">
          <div class="subject-code">
            <div class="subject-code-main">EDUC 1101</div>
            <div class="subject-code-year">SP5, 2020</div>
          </div>
          <div class="subject-body">
            <div class="subject-title">Design and Technology Education</div>
            <div class="subject-meta">City West · On campus</div>
          </div>
        </div>

        <div class="subject-item">
          <div class="subject-code">
            <div class="subject-code-main">EDUC 1102</div>
            <div class="subject-code-year">SP5, 2020</div>
          </div>
          <div class="subject-body">
            <div class="subject-title">
              Foundations in Learning and Teaching 1
            </div>
            <div class="subject-meta">City West · On campus</div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- TIMETABLE PAGE -->
  <section id="timetablePage" class="page">
    <div class="timetable-card">
      <div class="timetable-card-inner">
        <div class="small" style="opacity:0.9;">My timetable</div>
        <div class="home-top-title" style="margin-top:4px;">No classes</div>
        <div class="small" style="margin-top:6px;opacity:0.9;">
          Electronics lab, lectures and tutorials will show here once added.
        </div>
      </div>
    </div>
  </section>

  <!-- ASSIGNMENTS PAGE -->
  <section id="assignmentsPage" class="page">
    <div class="card">
      <div class="home-top">
        <div>
          <div class="small muted">Track your work</div>
          <div class="home-top-title">Assignments & grades</div>
        </div>
        <div>
          <span class="small muted">Average</span>
          <span id="avgBadge" class="badge">--%</span>
        </div>
      </div>

      <div class="assign-controls">
        <select id="filterUnit" class="select" onchange="renderAssignments()">
          <option value="all">All units</option>
        </select>
        <select id="filterStatus" class="select" onchange="renderAssignments()">
          <option value="all">All statuses</option>
          <option value="submitted">Submitted</option>
          <option value="pending">Pending</option>
          <option value="overdue">Overdue</option>
        </select>
        <select id="sortBy" class="select" onchange="renderAssignments()">
          <option value="due_asc">Due — soonest</option>
          <option value="due_desc">Due — latest</option>
          <option value="grade_desc">Grade — high → low</option>
          <option value="grade_asc">Grade — low → high</option>
        </select>
      </div>

      <div id="assignList" class="assign-list"></div>

      <div style="margin-top:10px;display:flex;gap:8px;flex-wrap:wrap">
        <button class="btn-link" onclick="openAddAssignment()">+ Add assignment</button>
        <button class="btn-link" onclick="exportAssignments()">Export JSON</button>
      </div>
    </div>
  </section>

  <!-- PROFILE PAGE -->
  <section id="profilePage" class="page">
    <div class="card profile-card">
      <div class="avatar"><span id="avatarInitials">LJ</span></div>
      <div class="profile-name" id="profileName">Luciano Jesse Rostirolla</div>
      <div class="profile-degree" id="profileDegree">Bachelor of Electrical Engineering</div>

      <div class="id-preview-wrapper" onclick="openIdCard()">
        <img src="id-card.png" alt="Student ID card" class="id-preview-image">
        <div class="small muted">Tap to view full screen</div>
      </div>

      <div class="profile-info">
        <div class="profile-row">
          <div class="profile-label">Student ID</div>
          <div id="profileID">739148265</div>
        </div>
        <div class="profile-row">
          <div class="profile-label">Date of birth</div>
          <div id="profileDOB">2/11/2006</div>
        </div>
      </div>
    </div>
  </section>
</main>

<!-- MODAL -->
<div id="modal" class="modal-backdrop" aria-hidden="true">
  <div class="modal" role="dialog" aria-modal="true">
    <div class="modal-head">
      <h3 id="modalTitle">Modal</h3>
      <button class="btn-link" onclick="closeModal()">Close</button>
    </div>
    <div id="modalBody" class="modal-body"></div>
  </div>
</div>

<!-- BOTTOM NAV -->
<nav class="bottom-nav">
  <div class="nav-item active" data-page="home" onclick="switchTo('home')">
    <svg width="18" height="18" viewBox="0 0 24 24" fill="none">
      <path d="M3 11.5L12 5l9 6.5"
            stroke="currentColor" stroke-width="1.6"
            stroke-linecap="round" stroke-linejoin="round" />
      <path d="M5 21V11h14v10"
            stroke="currentColor" stroke-width="1.6"
            stroke-linecap="round" stroke-linejoin="round" />
    </svg>
    <span>Home</span>
  </div>
  <div class="nav-item" data-page="timetable" onclick="switchTo('timetable')">
    <svg width="18" height="18" viewBox="0 0 24 24" fill="none">
      <rect x="3" y="4" width="18" height="18" rx="2"
            stroke="currentColor" stroke-width="1.6" />
      <path d="M16 2v4M8 2v4"
            stroke="currentColor" stroke-width="1.6" />
    </svg>
    <span>Timetable</span>
  </div>
  <div class="nav-item" data-page="assignments" onclick="switchTo('assignments')">
    <svg width="18" height="18" viewBox="0 0 24 24" fill="none">
      <rect x="3" y="4" width="18" height="16" rx="2"
            stroke="currentColor" stroke-width="1.6" />
      <path d="M9 8h6"
            stroke="currentColor" stroke-width="1.6" stroke-linecap="round" />
    </svg>
    <span>Assignments</span>
  </div>
  <div class="nav-item" data-page="profile" onclick="switchTo('profile')">
    <svg width="18" height="18" viewBox="0 0 24 24" fill="none">
      <circle cx="12" cy="8" r="3"
              stroke="currentColor" stroke-width="1.6" />
      <path d="M6 20c1.5-3 5-5 6-5s4.5 2 6 5"
            stroke="currentColor" stroke-width="1.6"
            stroke-linecap="round" />
    </svg>
    <span>Profile</span>
  </div>
</nav>

<script>
  /* STATE */
  const defaultProfile = {
    name: "Luciano Jesse Rostirolla",
    degree: "Bachelor of Electrical Engineering",
    id: "739148265",
    dob: "2/11/2006",
    email: "lucianorostirolla0@gmail.com",
    phone: "—",
    helpdesk: "Campus IT Help Desk — 08 5555 0000 · helpdesk@campus.example"
  };

  const demoAssignments = [
    {
      id: "a1",
      unit: "ELEC 101",
      title: "DC Circuits Lab Report",
      due: "2025-03-15",
      status: "submitted",
      grade: 86,
      notes: "Analysis of Ohm's law, Kirchhoff's laws and measured vs theoretical values."
    },
    {
      id: "a2",
      unit: "ELEC 130",
      title: "Intro to Programming for Engineers",
      due: "2025-03-28",
      status: "submitted",
      grade: 88,
      notes: "C program to sample sensor data and calculate RMS voltage."
    },
    {
      id: "a3",
      unit: "ELEC 150",
      title: "Logic Gates & Digital Systems Quiz",
      due: "2025-04-02",
      status: "submitted",
      grade: 78,
      notes: "K-maps, combinational circuits and basic flip-flop behaviour."
    },
    {
      id: "a4",
      unit: "ELEC 180",
      title: "PCB Schematic Assignment",
      due: "2025-04-18",
      status: "pending",
      grade: null,
      notes: "Design a regulated power supply and microcontroller interface."
    },
    {
      id: "a5",
      unit: "MATH 120",
      title: "Engineering Mathematics Test",
      due: "2025-03-05",
      status: "submitted",
      grade: 82,
      notes: "Complex numbers, phasors and basic differential equations."
    },
    {
      id: "a6",
      unit: "ELEC 210",
      title: "AC Circuits & Phasors Lab",
      due: "2025-04-30",
      status: "submitted",
      grade: 79,
      notes: "Measured impedance, power factor and resonance behaviour."
    },
    {
      id: "a7",
      unit: "ELEC 220",
      title: "Digital Logic Design Project",
      due: "2025-05-10",
      status: "submitted",
      grade: 74,
      notes: "Designed a 4-bit ALU using combinational and sequential logic."
    },
    {
      id: "a8",
      unit: "ENGN 150",
      title: "Physics for Engineers Problem Set",
      due: "2025-03-22",
      status: "submitted",
      grade: 81,
      notes: "Electromagnetism, basic circuits and field calculations."
    },
    {
      id: "a9",
      unit: "ELEC 230",
      title: "Microcontrollers Lab 1",
      due: "2025-05-20",
      status: "pending",
      grade: null,
      notes: "Blink and button input using timers and interrupts."
    }
  ];

  /* new key so old state doesn't interfere */
  let state = JSON.parse(localStorage.getItem("sp_state_v3") || "null");
  if (!state) {
    state = { profile: defaultProfile, assignments: demoAssignments };
    localStorage.setItem("sp_state_v3", JSON.stringify(state));
  }

  function persist() {
    localStorage.setItem("sp_state_v3", JSON.stringify(state));
  }

  /* NAVIGATION */
  function switchTo(page) {
    const map = {
      home: "homePage",
      timetable: "timetablePage",
      assignments: "assignmentsPage",
      profile: "profilePage"
    };

    document.querySelectorAll(".page").forEach(p => p.classList.remove("active"));
    document.getElementById(map[page]).classList.add("active");

    document.querySelectorAll(".nav-item").forEach(n => {
      n.classList.toggle("active", n.dataset.page === page);
    });

    const titleMap = {
      home: "Home",
      timetable: "Timetable",
      assignments: "Assignments",
      profile: "Profile"
    };
    document.getElementById("appTitle").innerText = "Student Portal — " + titleMap[page];

    if (page === "assignments") renderAssignments();
    if (page === "profile") renderProfile();
  }

  /* PROFILE */
  function renderProfile() {
    const p = state.profile;

    document.getElementById("profileName").innerText = p.name;
    document.getElementById("profileDegree").innerText = p.degree;
    document.getElementById("profileID").innerText = p.id;
    document.getElementById("profileDOB").innerText = p.dob || "";

    const first = p.name.split(" ")[0] || "Student";
    document.getElementById("welcomeName").innerText = first;

    const initials = (p.name.split(" ").map(s => s[0]).join("").slice(0, 2) || "SP").toUpperCase();
    document.getElementById("avatarInitials").innerText = initials;
  }

  /* SETTINGS (email + phone editable, helpdesk fixed) */
  function openSettings() {
    const p = state.profile;
    const body =
      '<label>Email<br>' +
        '<input id="set_email" class="input" value="' + escapeHtml(p.email || "") + '">' +
      '</label><br>' +
      '<label>Phone number<br>' +
        '<input id="set_phone" class="input" value="' + escapeHtml(p.phone || "") + '">' +
      '</label><br>' +
      '<div class="profile-row" style="margin-top:8px;">' +
        '<div class="profile-label">Help desk support</div>' +
        '<div style="margin-top:4px;">' + escapeHtml(p.helpdesk || "") + '</div>' +
      '</div><br>' +
      '<button class="btn-link" onclick="saveSettings()">Save</button>';

    openModal("Settings", body);
  }

  function saveSettings() {
    const p = state.profile;
    p.email = document.getElementById("set_email").value || p.email;
    p.phone = document.getElementById("set_phone").value || p.phone;
    /* helpdesk is fixed, not editable */

    persist();
    renderProfile();
    closeModal();
  }

  /* NOTES */
  function openNotes() {
    const existing = localStorage.getItem("sp_notes") || "";
    const body =
      '<label>Notes<br>' +
        '<textarea id="notesArea" class="input" rows="8" ' +
        'style="width:100%;resize:vertical;">' + escapeHtml(existing) + '</textarea>' +
      '</label><br>' +
      '<button class="btn-link" onclick="saveNotes()">Save</button>';

    openModal("Notes", body);
  }

  function saveNotes() {
    const val = document.getElementById("notesArea").value || "";
    localStorage.setItem("sp_notes", val);
    closeModal();
  }

  /* CAMPUS MAP */
  function openCampusMap() {
    const body =
      '<div class="map-fullscreen-wrapper">' +
        '<img src="campus-map.png" alt="Campus map" class="map-fullscreen-image">' +
      '</div>';

    openModal("Campus map", body, { fullscreen: true });
  }

  /* FULLSCREEN ID CARD */
  function openIdCard() {
    const body =
      '<div class="id-fullscreen-wrapper">' +
        '<img src="id-card.png" alt="Student ID card" class="id-fullscreen-image">' +
      '</div>';

    openModal("Student ID card", body, { fullscreen: true });
  }

  /* ASSIGNMENTS */
  function renderAssignments() {
    const list = document.getElementById("assignList");
    list.innerHTML = "";

    const unitSelect = document.getElementById("filterUnit");
    const statusFilter = document.getElementById("filterStatus").value;
    const sortBy = document.getElementById("sortBy").value;

    const units = [...new Set(state.assignments.map(a => a.unit))];
    unitSelect.innerHTML =
      '<option value="all">All units</option>' +
      units.map(u => '<option value="' + escapeHtml(u) + '">' + escapeHtml(u) + '</option>').join("");

    let items = [...state.assignments];

    const uVal = unitSelect.value;
    if (uVal !== "all") items = items.filter(a => a.unit === uVal);
    if (statusFilter !== "all") items = items.filter(a => a.status === statusFilter);

    items.sort((a, b) => {
      if (sortBy === "due_asc") return new Date(a.due) - new Date(b.due);
      if (sortBy === "due_desc") return new Date(b.due) - new Date(a.due);
      if (sortBy === "grade_desc") return (b.grade || 0) - (a.grade || 0);
      if (sortBy === "grade_asc") return (a.grade || 0) - (b.grade || 0);
      return 0;
    });

    const graded = state.assignments.filter(a => typeof a.grade === "number");
    const avg = graded.length
      ? Math.round(graded.reduce((s, x) => s + x.grade, 0) / graded.length)
      : 0;
    document.getElementById("avgBadge").innerText = graded.length ? avg + "%" : "--%";

    if (!items.length) {
      list.innerHTML = '<div class="small muted">No assignments match your filters.</div>';
      return;
    }

    items.forEach(a => {
      const dueStr = isNaN(new Date(a.due)) ? "—" : new Date(a.due).toLocaleDateString();
      const row = document.createElement("div");
      row.className = "card assign-row";
      row.innerHTML =
        '<div class="assign-left">' +
          '<div><strong>' + escapeHtml(a.title) + '</strong></div>' +
          '<div class="small muted">' + escapeHtml(a.unit) + ' · Due ' + dueStr + '</div>' +
        '</div>' +
        '<div style="text-align:right">' +
          '<div><strong>' + (typeof a.grade === "number" ? a.grade + "%" : "—") + '</strong></div>' +
          '<div class="small muted">' + a.status + '</div>' +
          '<button class="btn-link" onclick="openAssignment(\'' + a.id + '\')">Open</button>' +
        '</div>';

      list.appendChild(row);
    });
  }

  function openAssignment(id) {
    const a = state.assignments.find(x => x.id === id);
    if (!a) return;

    const body =
      '<strong>' + escapeHtml(a.title) + '</strong><br>' +
      '<span class="small muted">' + escapeHtml(a.unit) + '</span><br><br>' +
      '<div><strong>Due:</strong> ' + a.due + '</div>' +
      '<div><strong>Status:</strong> ' + a.status + '</div>' +
      '<div><strong>Grade:</strong> ' + (typeof a.grade === "number" ? a.grade + "%" : "—") + '</div><br>' +
      '<div><strong>Notes</strong><br>' + escapeHtml(a.notes || "—") + '</div><br>' +
      '<button class="btn-link" onclick="edi
